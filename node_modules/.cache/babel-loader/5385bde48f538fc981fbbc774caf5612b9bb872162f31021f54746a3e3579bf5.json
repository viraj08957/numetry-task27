{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Viraj/Desktop/task 27/login-register-mern/client/numetry-task27/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Viraj/Desktop/task 27/login-register-mern/client/numetry-task27/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";import jwt_decode from\"jwt-decode\";axios.defaults.baseURL=process.env.REACT_APP_SERVER_DOMAIN;//* Make API Requests\n/** To get username from Token */export function getUsername(){return _getUsername.apply(this,arguments);}// authenticate a user\nfunction _getUsername(){_getUsername=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var token,decode;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:token=localStorage.getItem(\"token\");if(token){_context.next=3;break;}return _context.abrupt(\"return\",Promise.reject(\"Cannot find Token\"));case 3:decode=jwt_decode(token);return _context.abrupt(\"return\",decode);case 5:case\"end\":return _context.stop();}},_callee);}));return _getUsername.apply(this,arguments);}export function authenticate(_x){return _authenticate.apply(this,arguments);}// get user details\nfunction _authenticate(){_authenticate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(username){var _yield$axios$post,status;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"/api/authenticate\",{username:username});case 3:_yield$axios$post=_context2.sent;status=_yield$axios$post.status;return _context2.abrupt(\"return\",status);case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",{error:\"Username does not exist\"});case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));return _authenticate.apply(this,arguments);}export function getUser(_x2){return _getUser.apply(this,arguments);}// Register user function\nfunction _getUser(){_getUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(username){var _yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.get(\"/api/user/\".concat(username));case 3:_yield$axios$get=_context3.sent;data=_yield$axios$get.data;return _context3.abrupt(\"return\",data);case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",{error:\"Password does'nt match\"});case 11:case\"end\":return _context3.stop();}},_callee3,null,[[0,8]]);}));return _getUser.apply(this,arguments);}export function registerUser(_x3){return _registerUser.apply(this,arguments);}// login function\nfunction _registerUser(){_registerUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(credentials){var _yield$axios$post2,msg,status,username,userEmail;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return axios.post(\"/api/register\",credentials);case 3:_yield$axios$post2=_context4.sent;msg=_yield$axios$post2.data.msg;status=_yield$axios$post2.status;username=credentials.username,userEmail=credentials.email;// send email if user registered successfully\nif(!(status===201)){_context4.next=10;break;}_context4.next=10;return axios.post(\"/api/registerMail\",{username:username,userEmail:userEmail,text:msg});case 10:return _context4.abrupt(\"return\",Promise.resolve(msg));case 13:_context4.prev=13;_context4.t0=_context4[\"catch\"](0);return _context4.abrupt(\"return\",Promise.reject({error:_context4.t0}));case 16:case\"end\":return _context4.stop();}},_callee4,null,[[0,13]]);}));return _registerUser.apply(this,arguments);}export function verifyPassword(_x4){return _verifyPassword.apply(this,arguments);}// update user profile function\nfunction _verifyPassword(){_verifyPassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(_ref){var username,password,_yield$axios$post3,data;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:username=_ref.username,password=_ref.password;_context5.prev=1;if(!username){_context5.next=8;break;}_context5.next=5;return axios.post(\"/api/login\",{username:username,password:password});case 5:_yield$axios$post3=_context5.sent;data=_yield$axios$post3.data;return _context5.abrupt(\"return\",Promise.resolve({data:data}));case 8:_context5.next=13;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](1);return _context5.abrupt(\"return\",Promise.reject({error:\"Password does not match\"}));case 13:case\"end\":return _context5.stop();}},_callee5,null,[[1,10]]);}));return _verifyPassword.apply(this,arguments);}export function updateUser(_x5){return _updateUser.apply(this,arguments);}// generate OTP\nfunction _updateUser(){_updateUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(response){var token,data;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return localStorage.getItem(\"token\");case 3:token=_context6.sent;_context6.next=6;return axios.put(\"/api/update-user\",response,{headers:{Authorization:\"Bearer \".concat(token)}});case 6:data=_context6.sent;return _context6.abrupt(\"return\",Promise.resolve({data:data}));case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](0);return _context6.abrupt(\"return\",Promise.reject({error:\"Couldn't update profile \"}));case 13:case\"end\":return _context6.stop();}},_callee6,null,[[0,10]]);}));return _updateUser.apply(this,arguments);}export function generateOTP(_x6){return _generateOTP.apply(this,arguments);}// verify otp\nfunction _generateOTP(){_generateOTP=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(username){var _yield$axios$get2,code,status,_yield$getUser,email,text;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return axios.get(\"/api/generateOTP\",{params:{username:username}});case 3:_yield$axios$get2=_context7.sent;code=_yield$axios$get2.data.code;status=_yield$axios$get2.status;console.log(\"code : \",code);// send mail with otp code\nif(!(status===201)){_context7.next=16;break;}_context7.next=10;return getUser(username);case 10:_yield$getUser=_context7.sent;email=_yield$getUser.user.email;text=\"Your OTP : \".concat(code,\"\\nVerify and recover your Password\");console.log(\"user email : \",email);_context7.next=16;return axios.post(\"/api/registerMail/\",{username:username,userEmail:email,text:text});case 16:return _context7.abrupt(\"return\",Promise.resolve(code));case 19:_context7.prev=19;_context7.t0=_context7[\"catch\"](0);return _context7.abrupt(\"return\",Promise.reject({error:_context7.t0}));case 22:case\"end\":return _context7.stop();}},_callee7,null,[[0,19]]);}));return _generateOTP.apply(this,arguments);}export function verifyOTP(_x7){return _verifyOTP.apply(this,arguments);}function _verifyOTP(){_verifyOTP=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(_ref2){var username,code,_yield$axios$get3,data,status;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:username=_ref2.username,code=_ref2.code;_context8.prev=1;_context8.next=4;return axios.get(\"/api/verifyOTP\",{params:{username:username,code:code}});case 4:_yield$axios$get3=_context8.sent;data=_yield$axios$get3.data;status=_yield$axios$get3.status;return _context8.abrupt(\"return\",{data:data,status:status});case 10:_context8.prev=10;_context8.t0=_context8[\"catch\"](1);return _context8.abrupt(\"return\",Promise.reject({error:_context8.t0}));case 13:case\"end\":return _context8.stop();}},_callee8,null,[[1,10]]);}));return _verifyOTP.apply(this,arguments);}export function resetPassword(_x8){return _resetPassword.apply(this,arguments);}function _resetPassword(){_resetPassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(_ref3){var username,password,_yield$axios$put,data,status;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:username=_ref3.username,password=_ref3.password;_context9.prev=1;_context9.next=4;return axios.put(\"/api/reset-password\",{username:username,password:password});case 4:_yield$axios$put=_context9.sent;data=_yield$axios$put.data;status=_yield$axios$put.status;return _context9.abrupt(\"return\",Promise.resolve({data:data,status:status}));case 10:_context9.prev=10;_context9.t0=_context9[\"catch\"](1);return _context9.abrupt(\"return\",Promise.reject({error:_context9.t0}));case 13:case\"end\":return _context9.stop();}},_callee9,null,[[1,10]]);}));return _resetPassword.apply(this,arguments);}","map":{"version":3,"names":["axios","jwt_decode","defaults","baseURL","process","env","REACT_APP_SERVER_DOMAIN","getUsername","token","localStorage","getItem","Promise","reject","decode","authenticate","username","post","status","error","getUser","get","data","registerUser","credentials","msg","userEmail","email","text","resolve","verifyPassword","password","updateUser","response","put","headers","Authorization","generateOTP","params","code","console","log","user","verifyOTP","resetPassword"],"sources":["C:/Users/Viraj/Desktop/task 27/login-register-mern/client/numetry-task27/src/helper/helper.js"],"sourcesContent":["import axios from \"axios\"\r\nimport jwt_decode from \"jwt-decode\"\r\n\r\naxios.defaults.baseURL = process.env.REACT_APP_SERVER_DOMAIN\r\n\r\n//* Make API Requests\r\n\r\n/** To get username from Token */\r\nexport async function getUsername() {\r\n  const token = localStorage.getItem(\"token\")\r\n  if (!token) return Promise.reject(\"Cannot find Token\")\r\n  let decode = jwt_decode(token)\r\n  return decode\r\n}\r\n\r\n// authenticate a user\r\nexport async function authenticate(username) {\r\n  try {\r\n    const { status } = await axios.post(\"/api/authenticate\", { username })\r\n    return status\r\n  } catch (error) {\r\n    return { error: \"Username does not exist\" }\r\n  }\r\n}\r\n\r\n// get user details\r\nexport async function getUser(username) {\r\n  try {\r\n    const { data } = await axios.get(`/api/user/${username}`)\r\n    return data\r\n  } catch (error) {\r\n    return { error: \"Password does'nt match\" }\r\n  }\r\n}\r\n\r\n// Register user function\r\nexport async function registerUser(credentials) {\r\n  try {\r\n    const {\r\n      data: { msg },\r\n      status,\r\n    } = await axios.post(`/api/register`, credentials)\r\n\r\n    let { username, email: userEmail } = credentials\r\n\r\n    // send email if user registered successfully\r\n    if (status === 201) {\r\n      await axios.post(\"/api/registerMail\", { username, userEmail, text: msg })\r\n    }\r\n    return Promise.resolve(msg)\r\n  } catch (error) {\r\n    return Promise.reject({ error })\r\n  }\r\n}\r\n\r\n// login function\r\n\r\nexport async function verifyPassword({ username, password }) {\r\n  try {\r\n    if (username) {\r\n      const { data } = await axios.post(\"/api/login\", { username, password })\r\n      return Promise.resolve({ data })\r\n    }\r\n  } catch (error) {\r\n    return Promise.reject({ error: \"Password does not match\" })\r\n  }\r\n}\r\n\r\n// update user profile function\r\n\r\nexport async function updateUser(response) {\r\n  try {\r\n    const token = await localStorage.getItem(\"token\")\r\n    const data = await axios.put(\"/api/update-user\", response, {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    })\r\n    return Promise.resolve({ data })\r\n  } catch (error) {\r\n    return Promise.reject({ error: \"Couldn't update profile \" })\r\n  }\r\n}\r\n\r\n// generate OTP\r\nexport async function generateOTP(username) {\r\n  try {\r\n    const {\r\n      data: { code },\r\n      status,\r\n    } = await axios.get(\"/api/generateOTP\", {\r\n      params: { username },\r\n    })\r\n    console.log(\"code : \", code)\r\n    // send mail with otp code\r\n    if (status === 201) {\r\n      let {\r\n        user: { email },\r\n      } = await getUser(username)\r\n      let text = `Your OTP : ${code}\\nVerify and recover your Password`\r\n      console.log(\"user email : \", email)\r\n      await axios.post(\"/api/registerMail/\", {\r\n        username,\r\n        userEmail: email,\r\n        text,\r\n      })\r\n    }\r\n    return Promise.resolve(code)\r\n  } catch (error) {\r\n    return Promise.reject({ error })\r\n  }\r\n}\r\n\r\n// verify otp\r\nexport async function verifyOTP({ username, code }) {\r\n  try {\r\n    const { data, status } = await axios.get(`/api/verifyOTP`, {\r\n      params: {\r\n        username,\r\n        code,\r\n      },\r\n    })\r\n    return { data, status }\r\n  } catch (error) {\r\n    return Promise.reject({ error })\r\n  }\r\n}\r\n\r\nexport async function resetPassword({ username, password }) {\r\n  try {\r\n    const { data, status } = await axios.put(\"/api/reset-password\", {\r\n      username,\r\n      password,\r\n    })\r\n    return Promise.resolve({ data, status })\r\n  } catch (error) {\r\n    return Promise.reject({ error })\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}